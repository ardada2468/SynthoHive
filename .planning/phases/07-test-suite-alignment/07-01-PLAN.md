---
phase: 07-test-suite-alignment
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - syntho_hive/tests/test_interface.py
autonomous: true
requirements:
  - TEST-01

must_haves:
  truths:
    - "pytest syntho_hive/tests/test_interface.py exits with 0 failures"
    - "test_synthesizer_fit_requires_spark passes: TrainingError is raised (not ValueError)"
    - "test_synthesizer_sample_requires_spark passes: TrainingError is raised (not ValueError)"
    - "test_synthesizer_fit_call passes: assertion checks only the positional paths arg, not kwargs"
    - "test_synthesizer_sample_call passes: args unpack matches actual call signature (output_path_base as kwarg)"
    - "All 10 previously passing tests remain passing"
  artifacts:
    - path: "syntho_hive/tests/test_interface.py"
      provides: "Fully aligned test suite with 0 failures"
      contains: "pytest.raises(TrainingError"
  key_links:
    - from: "syntho_hive/tests/test_interface.py"
      to: "syntho_hive/exceptions.py"
      via: "TrainingError import"
      pattern: "from syntho_hive.exceptions import.*TrainingError"
    - from: "test_synthesizer_fit_call"
      to: "StagedOrchestrator.fit_all"
      via: "call_args.args[0] positional check"
      pattern: "call_args\\.args\\[0\\]"
    - from: "test_synthesizer_sample_call"
      to: "StagedOrchestrator.generate"
      via: "keyword arg check for output_path_base"
      pattern: "call_args\\.kwargs"
---

<objective>
Fix 4 pre-existing failures in syntho_hive/tests/test_interface.py that were introduced by production code changes in phases 01-06. All fixes are confined to the test file — no production code changes.

Purpose: Close TD-02 from the v1.1 audit. The test suite must run clean (0 failures) before v1.1 ships.
Output: Updated test_interface.py with corrected exception assertions and call signature checks.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-test-suite-alignment/07-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix exception assertions and call signature checks in test_interface.py</name>
  <files>syntho_hive/tests/test_interface.py</files>
  <action>
Make exactly 4 targeted changes to syntho_hive/tests/test_interface.py. Do NOT touch any of the 10 passing tests.

**Change 1 — test_synthesizer_fit_requires_spark (line 49):**
The synthesizer.fit() wraps its internal ValueError in a TrainingError at the boundary (see synthesizer.py lines 136-140). The test must match what actually escapes the boundary.

Replace:
```python
    with pytest.raises(ValueError, match="SparkSession required"):
        syn.fit("test_db")
```
With:
```python
    with pytest.raises(TrainingError, match="SparkSession required"):
        syn.fit("test_db")
```

**Change 2 — test_synthesizer_sample_requires_spark (line 54):**
Same pattern — sample() also wraps its internal ValueError in TrainingError (synthesizer.py lines 173-177).

Replace:
```python
    with pytest.raises(ValueError, match="SparkSession required"):
        syn.sample({"users": 100})
```
With:
```python
    with pytest.raises(TrainingError, match="SparkSession required"):
        syn.sample({"users": 100})
```

**Change 3 — test_synthesizer_fit_call (line 66):**
assert_called_with() is brittle — it requires an exact positional+keyword match. The actual call is fit_all(paths, epochs=300, batch_size=500). The test should verify only that the correct paths were passed positionally, ignoring kwargs that may evolve.

Replace these two lines:
```python
        expected_paths = {'users': 'test_db.users', 'orders': 'test_db.orders'}
        syn.orchestrator.fit_all.assert_called_with(expected_paths)
```
With:
```python
        expected_paths = {'users': 'test_db.users', 'orders': 'test_db.orders'}
        assert syn.orchestrator.fit_all.call_args.args[0] == expected_paths
```

**Change 4 — test_synthesizer_sample_call (lines 74-78):**
The actual call is `generate(num_rows, output_path_base=None)` — `output_path_base` is a keyword arg, so `call_args.args` has only 1 element (num_rows), not 2. The stale assertion `"/tmp/syntho_hive_output/delta" == output_base` refers to a value that is never passed in the no-output-path branch.

Replace:
```python
        syn.orchestrator.generate.assert_called_once()
        # Verify output path
        args, _ = syn.orchestrator.generate.call_args
        rows, output_base = args
        assert rows == {"users": 50}
        assert "/tmp/syntho_hive_output/delta" == output_base
```
With:
```python
        syn.orchestrator.generate.assert_called_once()
        # Verify routing: correct row counts passed, output_path_base=None (in-memory branch)
        call = syn.orchestrator.generate.call_args
        assert call.args[0] == {"users": 50}
        assert call.kwargs.get("output_path_base") is None
```

**Import requirement:** TrainingError must be importable from the top of the file. The existing import block at line 6 is:
```python
from syntho_hive.exceptions import SchemaValidationError
```
Add TrainingError to this import:
```python
from syntho_hive.exceptions import SchemaValidationError, TrainingError
```

Verify the match string `"SparkSession required"` is still a valid substring of the TrainingError message `"fit() failed. Original error: SparkSession required for fit()"` — it is, so no change needed to match= patterns.
  </action>
  <verify>
Run: source /Users/arnavdadarya/FedEx/SynthoHive/.venv/bin/activate && pytest /Users/arnavdadarya/FedEx/SynthoHive/syntho_hive/tests/test_interface.py -v

Expected output: 14 passed, 0 failed

Also confirm TrainingError is in the import line:
grep "TrainingError" /Users/arnavdadarya/FedEx/SynthoHive/syntho_hive/tests/test_interface.py
  </verify>
  <done>
pytest exits with 0 failures and 14 passed. TrainingError is imported at top of file. The four previously failing tests now pass. The 10 previously passing tests are unchanged.
  </done>
</task>

</tasks>

<verification>
Run the full test file:
source /Users/arnavdadarya/FedEx/SynthoHive/.venv/bin/activate && pytest /Users/arnavdadarya/FedEx/SynthoHive/syntho_hive/tests/test_interface.py -v

Pass criteria:
- 14 passed, 0 failed
- No new warnings
- test_synthesizer_fit_requires_spark: PASSED
- test_synthesizer_sample_requires_spark: PASSED
- test_synthesizer_fit_call: PASSED
- test_synthesizer_sample_call: PASSED
</verification>

<success_criteria>
pytest syntho_hive/tests/test_interface.py exits with 0 failures. All 4 previously failing tests pass. No previously passing tests regress.
</success_criteria>

<output>
After completion, create .planning/phases/07-test-suite-alignment/07-01-SUMMARY.md
</output>
