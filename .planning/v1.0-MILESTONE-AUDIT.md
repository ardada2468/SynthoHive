---
milestone: v1.0
audited: 2026-02-22T09:00:00Z
status: tech_debt
scores:
  requirements: 10/10
  phases: 1/1
  integration: 5/5
  flows: 5/5
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 01-core-reliability
    items:
      - "Stale .venv installed package — `pip install -e .` needed before Phase 2 to align installed package with source (stale version produces 7 test failures when PYTHONPATH override is not set)"
      - "No test in `tests/` (milestone regression harness) exercises save_to_hive() with an invalid identifier and asserts SchemaError — CONN-04 implementation is correct and verified by code inspection, but the rejection path is untested in the canonical test suite"
      - "TrainingError imported in ctgan.py line 14 with misleading comment '# noqa: F401 – re-raised by CTGAN save/load' — TrainingError is raised only in synthesizer.py, never in ctgan.py"
      - "ConstraintViolationError imported in transformer.py line 7 with misleading comment '# noqa: F401 – used in Plan 03' — transformer.py never raises ConstraintViolationError (ctgan.py raises it post-hoc); the import is a forward reference placeholder"
      - "tests/repro_quickstart.py line 74 has bare `except: pass` around spark.stop() — outside syntho_hive/ package scope (CORE-04 scoped to production package), acceptable for a Spark cleanup utility but should be noted"
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0 (Core Reliability)
**Audited:** 2026-02-22T09:00:00Z
**Status:** TECH_DEBT — all requirements met, no critical blockers, 4 accumulated items for review
**Score:** 10/10 requirements satisfied | 1/1 phases complete | 5/5 E2E flows wired

---

## Executive Summary

Phase 1: Core Reliability is complete. All 10 requirements are satisfied. All 5 planned E2E flows are correctly wired and verified. The full test suite passes (12/12 tests). No critical blockers exist. Four tech debt items were identified — none prevent milestone completion, but the stale `.venv` package must be resolved before Phase 2.

---

## Requirements Coverage (10/10 SATISFIED)

| Requirement | Phase | Plans | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|-------------|-------|-------|-----------------|--------------------|--------------------|--------------|
| CORE-01 | 1 | 01-01 | SATISFIED | ✓ 01-01 | `[x]` | **satisfied** |
| CORE-02 | 1 | 01-02 | SATISFIED | ✓ 01-02 | `[x]` | **satisfied** |
| CORE-03 | 1 | 01-02 | SATISFIED | ✓ 01-02 | `[x]` | **satisfied** |
| CORE-04 | 1 | 01-01, 01-05 | SATISFIED | ✓ 01-01, 01-05 | `[x]` | **satisfied** |
| QUAL-04 | 1 | 01-03, 01-05 | SATISFIED | ✓ 01-03, 01-05 | `[x]` | **satisfied** |
| QUAL-05 | 1 | 01-03 | SATISFIED | ✓ 01-03 | `[x]` | **satisfied** |
| CONN-04 | 1 | 01-04 | SATISFIED | ✓ 01-04 | `[x]` | **satisfied** (see tech debt) |
| TEST-01 | 1 | 01-04 | SATISFIED | ✓ 01-04 | `[x]` | **satisfied** |
| TEST-03 | 1 | 01-04 | SATISFIED | ✓ 01-04 | `[x]` | **satisfied** |
| TEST-05 | 1 | 01-04 | SATISFIED | ✓ 01-04 | `[x]` | **satisfied** |

**Orphaned requirements (in traceability but absent from all VERIFICATIONs):** None
**Unsatisfied requirements:** None
**FAIL gate triggered:** No

---

## Phase Verification Summary

| Phase | Status | Score | Gaps | Regressions |
|-------|--------|-------|------|-------------|
| 01-core-reliability | ✓ PASSED | 5/5 must-haves | None | None |

Phase 1 underwent re-verification after gap closure (Plan 05):
- **Initial verification (2026-02-23T00:00:43Z):** 4/5 must-haves — QUAL-04 failed (warn+return instead of raise) and CORE-04 partial (3 new silent excepts introduced)
- **Re-verification (2026-02-22T08:00:00Z):** 5/5 must-haves — both gaps closed by Plan 05

---

## Integration Verification (5/5 E2E Flows)

### Flow 1: fit() → sample() (CORE-01 / TEST-01)

| Step | Status |
|------|--------|
| CTGAN(meta) → DataTransformer assigned | WIRED |
| CTGAN.fit(data, seed=42) → _set_seed → transformer.fit(seed) → ClusterBasedNormalizer(seed) | WIRED |
| CTGAN.sample(50, seed=7) → _set_seed → generator → transformer.inverse_transform | WIRED |
| Returns 50-row DataFrame, no all-null columns | VERIFIED |
| All exceptions typed; zero bare except: blocks | VERIFIED |

**Tests:** `test_single_table_e2e` PASSED, `test_single_table_fit_does_not_raise` PASSED

---

### Flow 2: fit() → save() → load() → sample() (CORE-02 / CORE-03 / TEST-03)

| Step | Status |
|------|--------|
| CTGAN.save(path) → 7-file directory checkpoint | WIRED |
| Overwrite guard → SerializationError when overwrite=False and path exists | WIRED |
| Fresh CTGAN().load(path) → restores all 7 components → transformer.output_dim > 0 | WIRED |
| new_model.sample(100, seed=7) → 100-row DataFrame, correct columns | VERIFIED |

**Tests:** `test_serialization_round_trip` PASSED, `test_save_raises_on_existing_path` PASSED, `test_save_overwrite_true_succeeds` PASSED, `test_load_raises_on_missing_path` PASSED

---

### Flow 3: sample(enforce_constraints=True) → ConstraintViolationError (QUAL-04)

| Step | Status |
|------|--------|
| ConstraintViolationError(SynthoHiveError) defined in exceptions.py line 40 | WIRED |
| Imported in ctgan.py line 14 | WIRED |
| raise ConstraintViolationError at ctgan.py line 614 with column+observed value format | WIRED |
| enforce_constraints=False (default) skips block entirely — backward compatible | WIRED |

**Tests:** All 4 `test_constraint_violation.py` tests PASSED

---

### Flow 4: Synthesizer(seed=42).fit().sample() → bit-identical output (QUAL-05 / TEST-05)

| Step | Status |
|------|--------|
| _set_seed(42) covers torch + numpy + random + cuDNN | WIRED |
| DataTransformer.fit(seed=42) → col_seed = (42 + abs(hash(col)) % 100_000) | WIRED |
| ClusterBasedNormalizer(seed=col_seed) → BayesianGaussianMixture(random_state=col_seed) | WIRED |
| sample(seed=7) → _set_seed(7) before noise generation | WIRED |
| pd.testing.assert_frame_equal(run1, run2, check_exact=True) → PASSES | VERIFIED |

**Tests:** `test_seed_produces_identical_output` PASSED (check_exact=True), `test_different_seeds_produce_different_output` PASSED

---

### Flow 5: save_to_hive(db_name) → _SAFE_IDENTIFIER validation → SchemaError (CONN-04)

| Step | Status |
|------|--------|
| _SAFE_IDENTIFIER = re.compile(r'^[a-zA-Z0-9_]+$') at synthesizer.py line 18 | WIRED |
| target_db validated at line 266 → SchemaError before any spark.sql() | WIRED |
| All synthetic_data.keys() validated at line 275 | WIRED |
| Happy-path test in syntho_hive/tests/test_interface.py | VERIFIED |
| **Note:** No test in tests/ validates SchemaError raise for invalid identifiers | PARTIAL (tech debt) |

---

## Cross-Component Wiring

| From | To | Via | Status |
|------|----|-----|--------|
| synthesizer.py | exceptions.py | SynthoHiveError, SchemaError, TrainingError, SerializationError | WIRED |
| ctgan.py | exceptions.py | SerializationError, ConstraintViolationError | WIRED |
| transformer.py | exceptions.py | ConstraintViolationError (forward ref, architecturally acceptable) | ACCEPTABLE |
| ctgan.py CTGAN.fit() | transformer.py DataTransformer.fit() | self.transformer.fit(data, seed=seed) | WIRED |
| transformer.py DataTransformer.fit() | ClusterBasedNormalizer | ClusterBasedNormalizer(seed=col_seed) | WIRED |
| synthesizer.py save_to_hive() | _SAFE_IDENTIFIER regex | _SAFE_IDENTIFIER.match(target_db) | WIRED |
| test_constraint_violation.py | ctgan.py CTGAN.sample() | pytest.raises(ConstraintViolationError) | WIRED |
| test_serialization.py | CTGAN.save() + load() | model.save(tmp_path) → new_model.load(tmp_path).sample() | WIRED |
| test_seed_regression.py | CTGAN.fit(seed=42) | Two independent instances; assert_frame_equal | WIRED |

**Broken connections:** 0
**Missing connections:** 0

---

## Orphaned Imports (Not Behavioral Issues)

| Location | Import | Issue | Severity |
|----------|--------|-------|----------|
| ctgan.py line 14 | `TrainingError` | Imported but never raised in ctgan.py; misleading noqa comment claims "re-raised by CTGAN save/load" — actually raised only in synthesizer.py | Info (cosmetic) |
| transformer.py line 7 | `ConstraintViolationError` | Misleading comment "used in Plan 03" — transformer clips but never raises; ctgan.py raises post-hoc | Info (cosmetic) |

Neither affects runtime behavior. Both are forward-reference placeholders with inaccurate comments.

---

## Tech Debt

### Item 1 — Stale `.venv` Package (High Priority: resolve before Phase 2)

**Location:** `.venv/lib/python3.14/site-packages/syntho_hive/`
**Issue:** Pre-Phase-1 version installed. Missing `_set_seed`, `enforce_constraints`, directory-based save/load. Running tests without `PYTHONPATH` override produces 7 failures (stale installed version loads instead of source).
**Fix:** `pip install -e .` from project root
**Phase 2 impact:** Phase 2 tests will fail intermittently if PYTHONPATH is not set correctly and the package is not reinstalled.

### Item 2 — No Milestone Regression Test for SchemaError (CONN-04)

**Location:** `tests/` (milestone test harness)
**Issue:** No test calls `save_to_hive()` with an invalid identifier (e.g., `"my-db"`, `"db; DROP TABLE"`) and asserts `SchemaError` is raised. The guard is verified by code inspection and exists in `syntho_hive/tests/test_interface.py` as a happy-path test, but the rejection path is not covered in the canonical test suite.
**Fix:** Add `test_save_to_hive_rejects_invalid_db_name` to `tests/test_e2e_single_table.py` or a new `tests/test_security.py`
**Phase 2 impact:** Low — CONN-04 implementation is correct. This is a coverage gap, not a behavioral gap.

### Item 3 — Misleading `# noqa` Comment on `TrainingError` Import (ctgan.py)

**Location:** `syntho_hive/core/models/ctgan.py` line 14
**Issue:** `# noqa: F401 – re-raised by CTGAN save/load` is inaccurate; TrainingError is raised only in synthesizer.py.
**Fix:** Remove `TrainingError` from the import or update comment to `# noqa: F401 – raised at synthesizer.py boundary; imported here for type availability`

### Item 4 — Misleading `# noqa` Comment on `ConstraintViolationError` Import (transformer.py)

**Location:** `syntho_hive/core/data/transformer.py` line 7
**Issue:** `# noqa: F401 – used in Plan 03` is stale/misleading. Plan 03 was revised in Plan 05 — ctgan.py now raises post-hoc; transformer.py only clips during inverse_transform.
**Fix:** Update comment to `# noqa: F401 – ctgan.py raises ConstraintViolationError post-hoc; transformer only clips`

---

## Test Results

```
============================= test session results ==============================
platform darwin -- Python 3.14.2, pytest-9.0.2
(run with PYTHONPATH=/Users/arnavdadarya/FedEx/SynthoHive)

tests/test_constraint_violation.py::test_enforce_constraints_raises_on_violation     PASSED
tests/test_constraint_violation.py::test_enforce_constraints_false_does_not_raise    PASSED
tests/test_constraint_violation.py::test_enforce_constraints_no_violation_does_not_raise PASSED
tests/test_constraint_violation.py::test_enforce_constraints_error_message_format    PASSED
tests/test_e2e_single_table.py::test_single_table_e2e                                PASSED
tests/test_e2e_single_table.py::test_single_table_fit_does_not_raise                 PASSED
tests/test_serialization.py::test_serialization_round_trip                           PASSED
tests/test_serialization.py::test_save_raises_on_existing_path                       PASSED
tests/test_serialization.py::test_save_overwrite_true_succeeds                       PASSED
tests/test_serialization.py::test_load_raises_on_missing_path                        PASSED
tests/test_seed_regression.py::test_seed_produces_identical_output                   PASSED
tests/test_seed_regression.py::test_different_seeds_produce_different_output         PASSED
========================== 12 passed in 7.68s ==================================
```

---

## Milestone Definition of Done

**Phase 1 Goal:** Engineers can train a model, save it, and load it in a separate process for inference — with typed exceptions surfacing every failure and a deterministic seed producing reproducible output

| Criterion | Status |
|-----------|--------|
| `synthesizer.fit()` raises typed exception on failure; no bare `except:` blocks | ✓ VERIFIED |
| `save(path)` → `load(path)` in fresh process → `sample()` produces output | ✓ VERIFIED |
| `Synthesizer(seed=42).fit().sample(100)` bit-identical across two independent runs | ✓ VERIFIED |
| Numeric constraint violations raise with column name and observed value | ✓ VERIFIED |
| `save_to_hive()` with invalid DB name raises before any SQL is executed | ✓ VERIFIED |

---

_Audited: 2026-02-22T09:00:00Z_
_Auditor: Claude (gsd-audit-milestone)_
