---
phase: 02-relational-correctness
plan: "05"
type: execute
wave: 1
depends_on: ["02-01-PLAN.md"]
files_modified:
  - syntho_hive/tests/test_interface.py
autonomous: true
requirements: [REL-03, TEST-02]
gap_closure: true

must_haves:
  truths:
    - "test_metadata_validation passes with SchemaValidationError instead of ValueError"
    - "test_metadata_invalid_fk_format passes with SchemaValidationError instead of ValueError"
    - "pytest syntho_hive/tests/test_interface.py -k 'test_metadata_validation or test_metadata_invalid_fk_format' exits 0 with 2 passed"
  artifacts:
    - path: "syntho_hive/tests/test_interface.py"
      provides: "Updated test file with correct exception assertions"
      contains: "from syntho_hive.exceptions import SchemaValidationError"
  key_links:
    - from: "syntho_hive/tests/test_interface.py"
      to: "syntho_hive/exceptions.py"
      via: "import SchemaValidationError"
      pattern: "from syntho_hive\\.exceptions import SchemaValidationError"
    - from: "syntho_hive/tests/test_interface.py"
      to: "syntho_hive/interface/config.py validate_schema()"
      via: "pytest.raises(SchemaValidationError)"
      pattern: "pytest\\.raises\\(SchemaValidationError"
---

<objective>
Fix the test regression in test_interface.py introduced by Plan 01. Two tests assert pytest.raises(ValueError) but validate_schema() now raises SchemaValidationError. Update both assertions and add the import.

Purpose: Phase 02 Plan 01 correctly changed validate_schema() to raise SchemaValidationError (a subclass of SchemaError, not ValueError). The tests that verified this behavior were written before the exception hierarchy change and were not updated. This is the only gap blocking phase 02 from gaps_found -> passed status.

Output: test_interface.py with corrected exception assertions; both tests pass; no other tests affected.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-relational-correctness/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix SchemaValidationError assertions in test_interface.py</name>
  <files>syntho_hive/tests/test_interface.py</files>
  <action>
    Read syntho_hive/tests/test_interface.py in full first.

    Make exactly three changes — nothing else:

    1. After the existing imports at the top of the file (after line 5 importing from syntho_hive.interface.config), add:
       ```python
       from syntho_hive.exceptions import SchemaValidationError
       ```

    2. In test_metadata_validation (line 34), change:
       ```python
       with pytest.raises(ValueError, match="references non-existent parent table"):
       ```
       to:
       ```python
       with pytest.raises(SchemaValidationError, match="references non-existent parent table"):
       ```

    3. In test_metadata_invalid_fk_format (line 38), change:
       ```python
       with pytest.raises(ValueError, match="Invalid FK reference"):
       ```
       to:
       ```python
       with pytest.raises(SchemaValidationError, match="Invalid FK reference"):
       ```

    Do NOT change any other lines. The four pre-existing failures (test_synthesizer_fit_requires_spark, test_synthesizer_sample_requires_spark, test_synthesizer_fit_call, test_synthesizer_sample_call) are pre-existing and out of scope — leave them as-is.

    SchemaValidationError is defined in syntho_hive/exceptions.py as a subclass of SchemaError (which is a subclass of SynthoHiveError). It does NOT inherit from ValueError — this is why the old pytest.raises(ValueError) calls fail.
  </action>
  <verify>
    Run from the project root:
    ```
    cd /Users/arnavdadarya/FedEx/SynthoHive && python -m pytest syntho_hive/tests/test_interface.py::test_metadata_validation syntho_hive/tests/test_interface.py::test_metadata_invalid_fk_format -v
    ```
    Expected output: 2 passed, 0 failed.

    Also confirm the import is present:
    ```
    grep "from syntho_hive.exceptions import SchemaValidationError" syntho_hive/tests/test_interface.py
    ```
    Expected: line is found.
  </verify>
  <done>
    Both test_metadata_validation and test_metadata_invalid_fk_format pass. The import from syntho_hive.exceptions is present. No previously-passing tests are broken by this change.
  </done>
</task>

</tasks>

<verification>
Run the two previously-failing tests in isolation:
```
cd /Users/arnavdadarya/FedEx/SynthoHive && python -m pytest syntho_hive/tests/test_interface.py::test_metadata_validation syntho_hive/tests/test_interface.py::test_metadata_invalid_fk_format -v
```
Expected: 2 passed.

Run the full test_interface.py to confirm no regressions introduced:
```
cd /Users/arnavdadarya/FedEx/SynthoHive && python -m pytest syntho_hive/tests/test_interface.py -v
```
Expected: 2 more passes than before this plan (the 4 pre-existing failures remain; no new failures).

Run the full test suite to confirm no cross-file regressions:
```
cd /Users/arnavdadarya/FedEx/SynthoHive && python -m pytest syntho_hive/tests/ -v
```
Expected: All tests that passed before this plan still pass; the 2 repaired tests now also pass.
</verification>

<success_criteria>
- `test_metadata_validation` passes: pytest.raises(SchemaValidationError) catches the exception raised when validate_schema() is called with a reference to a non-existent parent table
- `test_metadata_invalid_fk_format` passes: pytest.raises(SchemaValidationError) catches the exception raised when validate_schema() is called with a malformed FK reference (missing dot)
- The import `from syntho_hive.exceptions import SchemaValidationError` is present in test_interface.py
- No other test in test_interface.py changes pass/fail status as a result of this plan
- Phase 02 verification status can be upgraded from gaps_found to passed
</success_criteria>

<output>
After completion, create `.planning/phases/02-relational-correctness/02-05-SUMMARY.md` documenting:
- The regression root cause (Plan 01 changed exception type; tests not updated)
- The exact three-line fix applied
- Confirmation that both tests now pass
- Final phase 02 test status (which tests pass, which pre-existing failures remain)
</output>
