---
milestone: v1.1 Relational Correctness
audited: 2026-02-23T12:00:00Z
status: tech_debt
scores:
  requirements: 10/10
  phases: 2/2
  integration: 8/10
  flows: 3/5
gaps: []
tech_debt:
  - phase: 02-relational-correctness
    items:
      - "REL-03 partial wiring: Synthesizer.fit(validate=True) calls validate_schema() without real_data — data-level FK type mismatch detection unreachable through the public façade; must call meta.validate_schema(real_data) explicitly"
      - "4 pre-existing test failures in test_interface.py: ValueError raised inside Synthesizer.fit()/sample() wrapped as TrainingError; tests still expect ValueError — predates Phase 02, no regression"
      - "Human verification outstanding: production-scale FK chain test (10k+ rows) to confirm zero-orphan guarantee at realistic dataset size and full training epochs"
  - phase: 03-model-pluggability
    items:
      - "MODEL-02 issubclass guard missing at Synthesizer layer when spark_session=None: invalid model_cls silently accepted until StagedOrchestrator construction (which is deferred when no Spark session). Fix: add issubclass check directly in Synthesizer.__init__"
      - "Stale CTGAN-specific docstrings in orchestrator.py (lines 100, 104, 110, 124, 161, 188): 'Fit CTGAN and linkage models', 'training epochs for CTGAN', etc. — documentation-only, no functional impact"
---

# Milestone Audit: v1.1 Relational Correctness

**Audited:** 2026-02-23
**Scope:** Phase 02 (5/5 plans) + Phase 03 (3/3 plans) — full v1.1 milestone
**Status:** `tech_debt` — all 10 requirements satisfied; no critical blockers; 5 tech debt items accumulated

---

## Requirements Coverage — 3-Source Cross-Reference

All 10 milestone requirements verified against three independent sources:
1. Phase VERIFICATION.md status
2. Plan SUMMARY.md `provides` frontmatter
3. ROADMAP.md traceability table

### Phase 02 Requirements (REL-01, REL-02, REL-03, REL-04, REL-05, CONN-02, TEST-02)

| Requirement | Description | SUMMARY provides | VERIFICATION | ROADMAP | → Final Status |
|-------------|-------------|-----------------|-------------|---------|----------------|
| REL-01 | Fresh parent context per generator training step | 02-02 ✓ | SATISFIED | Phase 2 | **satisfied** |
| REL-02 | FK cardinality uses empirical/NegBinom — not Gaussian Mixture | 02-03 ✓ | SATISFIED | Phase 2 | **satisfied** |
| REL-03 | FK type mismatches raised at validate_schema() before training | 02-01, 02-05 ✓ | SATISFIED | Phase 2 | **satisfied** |
| REL-04 | Multi-table generation releases DataFrames from memory after disk write | 02-02 ✓ | SATISFIED | Phase 2 | **satisfied** |
| REL-05 | Generated parent/child tables join with zero orphaned FK references | 02-04 ✓ | SATISFIED | Phase 2 | **satisfied** |
| CONN-02 | PySpark 4.0+ / delta-spark 4.0+ pins match installed venv | 02-02 ✓ | SATISFIED | Phase 2 | **satisfied** |
| TEST-02 | Multi-table E2E: 3-table FK zero-orphan test passes | 02-04, 02-05 ✓ | SATISFIED | Phase 2 | **satisfied** |

**Score: 7/7 — no orphaned or unsatisfied Phase 02 requirements.**

### Phase 03 Requirements (MODEL-01, MODEL-02, MODEL-03)

| Requirement | Description | SUMMARY provides | VERIFICATION | ROADMAP | → Final Status |
|-------------|-------------|-----------------|-------------|---------|----------------|
| MODEL-01 | StagedOrchestrator accepts model_cls — no hardcoded CTGAN in orchestration | 03-01 ✓ | SATISFIED | Phase 3 | **satisfied** |
| MODEL-02 | Synthesizer exposes model parameter with documented supported classes | 03-02 ✓ | SATISFIED | Phase 3 | **satisfied** |
| MODEL-03 | Any ConditionalGenerativeModel implementation routes through full multi-table pipeline | 03-02, 03-03 ✓ | SATISFIED | Phase 3 | **satisfied** |

**Score: 3/3 — no orphaned or unsatisfied Phase 03 requirements.**

### Orphan Detection

No orphaned requirements. Every REQ-ID assigned to Phases 2–3 in ROADMAP.md appears in its phase's VERIFICATION.md with SATISFIED status and has corresponding plan SUMMARY.md evidence.

**Overall: 10/10 requirements satisfied. FAIL gate: not triggered.**

---

## Phase Verification Summary

| Phase | Plans | VERIFICATION.md | Score | Previous | Final Status |
|-------|-------|----------------|-------|----------|-------------|
| 02-relational-correctness | 5/5 | present | 5/5 | gaps_found → re-verified → passed | ✓ passed |
| 03-model-pluggability | 3/3 | present | 7/7 | gaps_found → re-verified → passed | ✓ passed |

Both phases required re-verification and gap closure before reaching `passed`:
- Phase 02 gap closed via Plan 05: SchemaValidationError assertions in test_interface.py
- Phase 03 gap closed via Plan 03-03: pytest addopts importlib fix in pyproject.toml

---

## Integration Check Summary

Integration checker verified cross-phase wiring across all 10 requirement paths.

| Check | Req(s) | Status | Notes |
|-------|--------|--------|-------|
| model_cls DI end-to-end: Synthesizer → StagedOrchestrator → self.model_cls() | MODEL-01, MODEL-03 | WIRED | synthesizer.py:68 passes model_cls=self.model_cls; orchestrator.py:130,182 use self.model_cls() |
| Synthesizer.model= parameter stores and forwards | MODEL-02 | WIRED | synthesizer.py:37 model param; :63 self.model_cls=model; :68 forwarded |
| issubclass guard (orchestrator level) | MODEL-01 | WIRED | orchestrator.py:81-86 raises TypeError at __init__ time |
| issubclass guard (Synthesizer level, no-Spark path) | MODEL-02 | PARTIAL | Guard fires only when spark_session provided; silent for spark_session=None |
| SchemaValidationError export chain | REL-03, TEST-02 | WIRED | exceptions.py → __init__.py → test imports confirmed by integration checker |
| linkage_method → LinkageModel wiring | REL-02 | WIRED | orchestrator.py:156-157 reads TableConfig.linkage_method → LinkageModel(method=…) |
| validate_schema structural check via Synthesizer.fit() | REL-03 | PARTIAL | synthesizer.py:105 calls validate_schema() without real_data; data-level FK checks unreachable |
| CTGAN legacy_context_conditioning=False default | REL-01 | WIRED | ctgan.py:84; generator step :408-414; persisted in save/load |
| write-and-release in generate() | REL-04 | WIRED | orchestrator.py:281-294; DataFrames not in generated_tables when output_path_base set |
| TestFKChainIntegrity zero-orphan proof | REL-05, TEST-02 | WIRED | 5 tests pass; test_3_table_chain and test_4_table_chain confirmed |

**Integration score: 8/10 connection paths fully wired; 2 partial (non-blocking tech debt)**

---

## E2E Flow Coverage

| Flow | Steps | Status | Break Point |
|------|-------|--------|-------------|
| Single-model fit → sample (CTGAN default, no Spark) | Synthesizer() → fit_all() → generate() | Complete | — |
| Custom model routing: Synthesizer(model=StubModel) → orchestration | model= stored → model_cls forwarded → StubModel.fit()/sample() called | Complete | — |
| issubclass guard rejection (orchestrator path) | StagedOrchestrator(model_cls=InvalidClass) → TypeError | Complete | — |
| E2E FK type mismatch caught before training (through Synthesizer) | Synthesizer.fit(validate=True) → validate_schema(real_data) → SchemaValidationError | Broken | synthesizer.py:105 — called without real_data |
| issubclass guard rejection (Synthesizer, no-Spark path) | Synthesizer(model=InvalidClass, spark_session=None) → TypeError | Broken | synthesizer.py:67-70 — guard deferred until StagedOrchestrator construction |

**Flow score: 3/5 complete; 2 broken (both are tech debt, neither blocks the satisfied requirements)**

---

## Tech Debt Details

### Phase 02 Tech Debt

#### TD-01: validate_schema() Not Receiving real_data in Synthesizer.fit()

**File:** `syntho_hive/interface/synthesizer.py`, line 105
**Severity:** Notable

`Synthesizer.fit(validate=True)` calls `self.metadata.validate_schema()` with no arguments — structural-only validation. Data-level FK type mismatch detection requires `validate_schema(real_data=DataFrames)`. An engineer passing mismatched int PK / str FK schemas through the Synthesizer façade will not get `SchemaValidationError` at fit-time; they'll encounter it only if they call `validate_schema` manually, or not at all.

**Fix:** Add `self.metadata.validate_schema(real_data)` call in `Synthesizer.fit()`, passing the loaded DataFrames before `self.orchestrator.fit_all()`.
**Note:** Does NOT affect REL-03 requirement status — tests call `validate_schema(real_data=…)` directly and all pass.

#### TD-02: Pre-existing Test Failures (4 tests in test_interface.py)

**File:** `syntho_hive/tests/test_interface.py`, lines 47, 52, 57, 68
**Severity:** Low — predates both phases; no regression

- `test_synthesizer_fit_requires_spark` / `test_synthesizer_sample_requires_spark`: expect `ValueError`, receive `TrainingError` (exception wrapper in Synthesizer wraps ValueError as TrainingError)
- `test_synthesizer_fit_call` / `test_synthesizer_sample_call`: test assertions reference older API contracts (hardcoded paths, old call signatures) that no longer match implementation

**Fix:** Update test assertions to match current Synthesizer API: `pytest.raises(TrainingError)` and updated call signature checks.

#### TD-03: Production-Scale Human Verification Pending

**From:** Phase 02 VERIFICATION.md human_verification section
**Severity:** Unknown

Automated TestFKChainIntegrity uses `epochs=2`, `batch_size=20`, 5–20 parent rows. Real-world generation at 10k+ rows and full training may expose timing, memory, or join-key assignment issues not visible at small scale.

**Action:** Run 3-table and 4-table FK chain tests with 10,000+ parent rows and realistic cardinality (2–10 children per parent); confirm zero orphans and stable memory.

---

### Phase 03 Tech Debt

#### TD-04: issubclass Guard Missing at Synthesizer Layer (no-Spark path)

**File:** `syntho_hive/interface/synthesizer.py`, lines 63–70
**Severity:** Low

When `spark_session=None`, `self.orchestrator = None` is set and the `StagedOrchestrator` issubclass guard never fires. `Synthesizer(model=InvalidClass, spark_session=None)` silently stores the invalid class and defers the error until `fit()` is called (when Spark is required anyway). The error message will be confusing — `AttributeError` or `TypeError` from inside fit_all() rather than a clear `TypeError: model_cls must be a subclass of ConditionalGenerativeModel`.

**Fix:** Add `if not (isinstance(model, type) and issubclass(model, ConditionalGenerativeModel)): raise TypeError(...)` directly in `Synthesizer.__init__()`, before the Spark check.

#### TD-05: Stale CTGAN References in Orchestrator Docstrings

**File:** `syntho_hive/relational/orchestrator.py`, lines 100, 104, 110, 124, 161, 188
**Severity:** Low — documentation only

Docstrings and comments reference "Fit CTGAN and linkage models", "training epochs for CTGAN", "Train Conditional CTGAN" despite the model being fully pluggable. No functional impact — model selection is correctly delegated to `self.model_cls()`.

**Fix:** Update docstrings to reference "configured model" / `ConditionalGenerativeModel` instead of CTGAN.

---

## Anti-Patterns Summary

| File | Issue | Severity |
|------|-------|---------|
| `test_interface.py:47,52,57,68` | 4 pre-existing failures — ValueError/TrainingError mismatch + stale call assertions | INFO (pre-existing, no regression) |
| `test_relational.py` | ConvergenceWarning from sklearn GMM in DataTransformer during test output | INFO (non-fatal, unrelated to LinkageModel) |
| `orchestrator.py:100,104,110,124,161,188` | CTGAN-specific docstrings despite pluggable model architecture | WARNING (docs only) |

**No BLOCKER anti-patterns. Both phases introduced zero new blocker anti-patterns.**

---

## Re-verification Summary

Both phases required re-verification:

| Phase | Initial | Gap | Fix | Final |
|-------|---------|-----|-----|-------|
| 02 | gaps_found (4/5) | test_interface.py asserting ValueError on SchemaValidationError | Plan 02-05: updated assertions to SchemaValidationError (commit c01056a) | passed (5/5) |
| 03 | gaps_found (6/7) | pytest resolved stale site-packages copy instead of editable source | Plan 03-03: addopts = "--import-mode=importlib" in pyproject.toml (commit a4ecfad) | passed (7/7) |

---

*Audited: 2026-02-23*
*Auditor: Claude (gsd-integration-checker + orchestrator)*
*Milestone: v1.1 Relational Correctness (Phases 02–03)*
